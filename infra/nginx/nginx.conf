events {}
http {
  server {
    listen 80;
    # Security headers
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' *; frame-ancestors 'none'" always;
    # Frontend (served by frontend container's nginx)
    location / {
      proxy_pass http://frontend:80/;
    }
    # Backend API
    location /api/ {
      proxy_pass http://backend:3000/;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    # AI Engine
    location /ai/ {
      proxy_pass http://ai_engine:8000/;
    }
    location /healthz { return 200 'ok'; }
    location /health { return 200 'ok'; }
  }
}
